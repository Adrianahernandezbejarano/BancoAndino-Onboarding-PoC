# Sistema Inteligente de Detecci√≥n de Inconsistencias - Banco Andino

## üìã Resumen Ejecutivo

Sistema automatizado para la detecci√≥n de inconsistencias entre formularios digitales y documentos cargados durante el proceso de onboarding de personas naturales, utilizando servicios AWS y tecnolog√≠as de IA.

---

## üéØ Objetivos

### Objetivos Principales
- **Mejorar la calidad de la informaci√≥n**: Validaci√≥n autom√°tica y cruzada de datos
- **Eficiencia operativa**: Reducci√≥n de tiempos de validaci√≥n de 2-3 d√≠as a minutos
- **Seguridad y cumplimiento**: Adherencia a normativas KYC, AML y SARLAFT

### Beneficios Esperados
- ‚úÖ Reducci√≥n del 80% en errores manuales
- ‚úÖ Disminuci√≥n del 70% en tiempos de validaci√≥n
- ‚úÖ Mejora en trazabilidad y auditor√≠a
- ‚úÖ Reducci√≥n de riesgos de cumplimiento normativo

---

## üèóÔ∏è Arquitectura del Sistema

### Componentes por Capas

#### 1Ô∏è‚É£ Capa de Cliente
- **App de Onboarding Digital**: Interfaz web/m√≥vil para captura de datos
- **Autenticaci√≥n Segura**: AWS Cognito con MFA
- **Validaciones en tiempo real**: Formato, completitud de datos

#### 2Ô∏è‚É£ Capa de Entrada
- **API Gateway**: Punto de entrada √∫nico y seguro
- **Validaci√≥n de esquemas**: JSON Schema validation
- **Rate limiting**: Protecci√≥n contra abusos

#### 3Ô∏è‚É£ Capa de Almacenamiento
- **Amazon S3**: 
  - Documentos originales (c√©dulas, RUT, estados financieros)
  - Lifecycle policies para archivado
  - Versionamiento habilitado
- **DynamoDB**:
  - Formularios digitales
  - Resultados de validaciones
  - Metadatos de procesamiento
  - Estado de solicitudes

#### 4Ô∏è‚É£ Capa de Procesamiento Inteligente

**Extracci√≥n de Datos (OCR/IDP)**
- **Amazon Textract**: Extracci√≥n de texto estructurado y tablas
- **Amazon Rekognition**: Detecci√≥n de rostros, validaci√≥n de documentos
- **Procesamiento**: Lambda functions para orquestaci√≥n

**An√°lisis y Comprensi√≥n (NLP)**
- **Amazon Comprehend**: An√°lisis de entidades, sentimiento
- **Amazon SageMaker**: Modelos personalizados para:
  - Clasificaci√≥n de documentos
  - Detecci√≥n de anomal√≠as
  - Scoring de riesgo

**Motor de Comparaci√≥n**
- **Lambda Functions**: L√≥gica de comparaci√≥n campo por campo
- **Reglas de validaci√≥n**:
  - Coincidencia exacta (nombres, n√∫meros de identificaci√≥n)
  - Coincidencia aproximada (direcciones, fuzzy matching)
  - Validaci√≥n de rangos (fechas, montos)

**Motor de Reglas e IA**
- **Reglas de negocio**: Validaciones configurables
- **Machine Learning**: Detecci√≥n de patrones an√≥malos
- **Scoring de riesgo**: Clasificaci√≥n autom√°tica de solicitudes

#### 5Ô∏è‚É£ Capa de Reportes y Alertas
- **Generador de Reportes**: Lambda + QuickSight
- **Sistema de Notificaciones**:
  - SNS para alertas cr√≠ticas
  - SQS para procesamiento as√≠ncrono
  - EventBridge para orquestaci√≥n

#### 6Ô∏è‚É£ Capa de Revisi√≥n Humana
- **Dashboard de Analistas**: Portal web con casos pendientes
- **Workflow de aprobaci√≥n**: Estados y transiciones
- **Herramientas de comparaci√≥n**: Vista lado a lado

#### 7Ô∏è‚É£ Capa de Seguridad y Auditor√≠a
- **IAM**: Control de acceso granular
- **KMS**: Encriptaci√≥n de datos sensibles
- **CloudWatch**: Logs y m√©tricas
- **CloudTrail**: Auditor√≠a de acciones
- **AWS Config**: Cumplimiento de pol√≠ticas

---

## üìä Diagrama de Secuencia

```plantuml
@startuml
!theme plain
skinparam backgroundColor #FEFEFE
skinparam sequenceMessageAlign center

actor Cliente
participant "App Banco\nAndino" as App
participant "API Gateway" as API
participant "Lambda\nOrquestador" as Lambda
participant "S3" as S3
participant "OCR/IDP\n(Textract)" as OCR
participant "Motor de\nComparaci√≥n" as Comparador
participant "Motor de\nReglas/IA" as MotorIA
participant "DynamoDB" as DB
participant "Generador de\nReportes" as Reportes
participant "SNS/SQS" as Notif
participant "Backoffice\nAnalista" as Analista

Cliente -> App: 1. Completa formulario\ny carga documentos
App -> API: 2. POST /onboarding\n{formulario, documentos}
API -> Lambda: 3. Invoca funci√≥n\norquestadora

Lambda -> S3: 4. Almacena documentos
S3 --> Lambda: 4.1. URL documentos

Lambda -> DB: 5. Guarda formulario\ny metadata
DB --> Lambda: 5.1. ID solicitud

Lambda -> OCR: 6. Extrae datos\nde documentos
activate OCR
OCR -> OCR: 6.1. Textract\nprocesa im√°genes
OCR --> Lambda: 6.2. Datos extra√≠dos\n(JSON estructurado)
deactivate OCR

Lambda -> Comparador: 7. Compara datos\nformulario vs documentos
activate Comparador
Comparador -> Comparador: 7.1. Validaci√≥n\ncampo por campo
Comparador -> Comparador: 7.2. Fuzzy matching\npara textos
Comparador --> Lambda: 7.3. Lista de\ninconsistencias
deactivate Comparador

Lambda -> MotorIA: 8. Eval√∫a con\nreglas e IA
activate MotorIA
MotorIA -> MotorIA: 8.1. Aplica reglas\nde negocio
MotorIA -> MotorIA: 8.2. ML: scoring\nde riesgo
MotorIA -> MotorIA: 8.3. Clasificaci√≥n:\nAPROBADO/REVISI√ìN/RECHAZADO
MotorIA --> Lambda: 8.4. Decisi√≥n y score
deactivate MotorIA

Lambda -> DB: 9. Actualiza estado\ny resultados
DB --> Lambda: 9.1. Confirmaci√≥n

Lambda -> Reportes: 10. Genera reporte\nde validaci√≥n
activate Reportes
Reportes -> Reportes: 10.1. Consolida\ninconsistencias
Reportes -> S3: 10.2. Guarda reporte PDF
Reportes --> Lambda: 10.3. URL reporte
deactivate Reportes

alt Caso requiere revisi√≥n humana
    Lambda -> Notif: 11. Notifica a analista
    Notif -> Analista: 11.1. Email/Dashboard\nalerta
    
    Analista -> App: 12. Accede dashboard
    Analista -> DB: 13. Consulta detalles\nde solicitud
    DB --> Analista: 13.1. Datos completos
    
    Analista -> Analista: 14. Revisa y decide
    Analista -> DB: 15. Actualiza decisi√≥n\nfinal
    
    DB -> Notif: 16. Trigger notificaci√≥n
    Notif -> Cliente: 16.1. Notifica resultado
else Caso aprobado autom√°ticamente
    Lambda -> Notif: 11. Notifica aprobaci√≥n
    Notif -> Cliente: 11.1. Email de\naprobaci√≥n
end

Lambda --> API: 17. Respuesta inicial
API --> App: 18. Status: En proceso
App --> Cliente: 19. Confirmaci√≥n\nde recepci√≥n

@enduml
```

---

## üîÑ Diagrama de Interacci√≥n de Entidades

```plantuml
@startuml
!theme plain

skinparam backgroundColor #FEFEFE
skinparam component {
    BackgroundColor<<input>> LightBlue
    BackgroundColor<<process>> LightGreen
    BackgroundColor<<output>> LightYellow
    BackgroundColor<<human>> LightCoral
}

component "Formulario\nDigital" as Form <<input>> {
    [Datos personales]
    [Datos financieros]
    [Datos laborales]
}

component "Documentos\nCargados" as Docs <<input>> {
    [C√©dula]
    [RUT]
    [Estados financieros]
    [Certificado laboral]
}

component "OCR/IDP" as OCR <<process>> {
    [Textract]
    [Rekognition]
    [Comprehend]
}

component "Comparador" as Comp <<process>> {
    [Validador de campos]
    [Fuzzy matching]
    [Detecci√≥n de anomal√≠as]
}

component "Motor de\nReglas/IA" as Motor <<process>> {
    [Reglas de negocio]
    [ML scoring]
    [Clasificador]
}

component "Reporte" as Report <<output>> {
    [Inconsistencias]
    [Score de riesgo]
    [Recomendaci√≥n]
}

actor "Analista" as Analyst <<human>>

database "DynamoDB" as DB
storage "S3" as S3

Form --> DB: 1. Almacena
Docs --> S3: 2. Almacena

DB --> OCR: 3. Lee formulario
S3 --> OCR: 4. Lee documentos

OCR --> Comp: 5. Datos extra√≠dos\n(estructurados)
DB --> Comp: 6. Datos formulario

Comp --> Motor: 7. Inconsistencias\ndetectadas

Motor --> Report: 8. Genera reporte\ncon decisi√≥n

Report --> DB: 9. Guarda resultados
Report --> S3: 10. Guarda PDF

DB --> Analyst: 11. Consulta casos\npendientes
S3 --> Analyst: 12. Descarga\ndocumentos

Analyst --> DB: 13. Actualiza\ndecisi√≥n final

note right of OCR
  Extracci√≥n inteligente
  de datos de documentos
  usando IA
end note

note right of Comp
  Comparaci√≥n autom√°tica
  con tolerancia a
  variaciones
end note

note right of Motor
  Decisi√≥n basada en
  reglas + ML
  APROBADO/REVISI√ìN/RECHAZADO
end note

@enduml
```

---

## üèõÔ∏è Arquitectura AWS Detallada

### C√≥digo Python para Generar Diagrama

```python
# diagrams_banco_andino.py
from diagrams import Diagram, Cluster, Edge
from diagrams.aws.compute import Lambda
from diagrams.aws.storage import S3, SimpleStorageServiceS3BucketWithObjects
from diagrams.aws.database import Dynamodb
from diagrams.aws.network import APIGateway
from diagrams.aws.security import Cognito, IAM, KMS
from diagrams.aws.ml import Rekognition, Comprehend, Sagemaker, Textract
from diagrams.aws.integration import SNS, SQS, Eventbridge
from diagrams.aws.management import Cloudwatch, CloudwatchEventTimeBased
from diagrams.aws.analytics import Quicksight

# Configuraci√≥n del diagrama
graph_attr = {
    "fontsize": "14",
    "bgcolor": "white",
    "pad": "0.5",
    "splines": "ortho"
}

with Diagram("Arquitectura Onboarding Banco Andino", 
             show=False, 
             direction="TB",
             graph_attr=graph_attr,
             filename="banco_andino_architecture"):
    
    # CAPA DE CLIENTE
    with Cluster("Capa de Cliente"):
        cognito = Cognito("Autenticaci√≥n\nMFA")
        app = Lambda("App Web/M√≥vil")
    
    # CAPA DE ENTRADA
    with Cluster("Capa de Entrada"):
        api_gateway = APIGateway("API Gateway\nRESTful")
        lambda_auth = Lambda("Validador\nde Entrada")
    
    # CAPA DE ALMACENAMIENTO
    with Cluster("Capa de Almacenamiento"):
        s3_docs = S3("Documentos\nOriginales")
        s3_reports = S3("Reportes\nGenerados")
        dynamodb = Dynamodb("Formularios\ny Estados")
    
    # CAPA DE PROCESAMIENTO INTELIGENTE
    with Cluster("Capa de Procesamiento Inteligente"):
        
        with Cluster("Extracci√≥n de Datos"):
            textract = Textract("Textract\nOCR")
            rekognition = Rekognition("Rekognition\nAn√°lisis Visual")
        
        with Cluster("An√°lisis NLP"):
            comprehend = Comprehend("Comprehend\nNLP")
            sagemaker = Sagemaker("SageMaker\nML Custom")
        
        with Cluster("L√≥gica de Negocio"):
            lambda_comparador = Lambda("Comparador\nde Datos")
            lambda_motor = Lambda("Motor de\nReglas/IA")
            lambda_orquestador = Lambda("Orquestador\nPrincipal")
    
    # CAPA DE REPORTES Y ALERTAS
    with Cluster("Capa de Reportes y Notificaciones"):
        lambda_reportes = Lambda("Generador\nde Reportes")
        sns = SNS("SNS\nAlertas")
        sqs = SQS("SQS\nCola Tareas")
        eventbridge = Eventbridge("EventBridge\nOrquestaci√≥n")
        quicksight = Quicksight("QuickSight\nDashboards")
    
    # CAPA DE SEGURIDAD Y AUDITOR√çA
    with Cluster("Seguridad y Auditor√≠a"):
        iam = IAM("IAM\nControl Acceso")
        kms = KMS("KMS\nEncriptaci√≥n")
        cloudwatch = Cloudwatch("CloudWatch\nLogs & M√©tricas")
    
    # CAPA DE REVISI√ìN HUMANA
    with Cluster("Backoffice"):
        lambda_dashboard = Lambda("Dashboard\nAnalistas")
    
    # ===== FLUJO PRINCIPAL =====
    
    # Cliente -> Autenticaci√≥n -> API
    app >> Edge(label="1. Auth") >> cognito
    cognito >> Edge(label="2. Token") >> api_gateway
    api_gateway >> Edge(label="3. Validate") >> lambda_auth
    
    # Lambda Auth -> Almacenamiento
    lambda_auth >> Edge(label="4. Store Docs") >> s3_docs
    lambda_auth >> Edge(label="5. Store Form") >> dynamodb
    lambda_auth >> Edge(label="6. Trigger") >> lambda_orquestador
    
    # Orquestador -> Procesamiento
    lambda_orquestador >> Edge(label="7. Extract Text") >> textract
    textract >> Edge(label="7.1. Text Data") >> lambda_comparador
    
    lambda_orquestador >> Edge(label="8. Analyze Image") >> rekognition
    rekognition >> Edge(label="8.1. Face/Doc") >> lambda_comparador
    
    s3_docs >> Edge(label="Read Docs") >> textract
    s3_docs >> Edge(label="Read Images") >> rekognition
    
    dynamodb >> Edge(label="Read Form") >> lambda_comparador
    
    # Comparador -> Motor de Reglas
    lambda_comparador >> Edge(label="9. Inconsistencies") >> lambda_motor
    
    # Motor de Reglas -> An√°lisis IA
    lambda_motor >> Edge(label="10. NLP Analysis") >> comprehend
    lambda_motor >> Edge(label="11. ML Scoring") >> sagemaker
    
    # Motor -> Reportes
    lambda_motor >> Edge(label="12. Results") >> lambda_reportes
    lambda_reportes >> Edge(label="13. Save Report") >> s3_reports
    lambda_reportes >> Edge(label="14. Update Status") >> dynamodb
    
    # Notificaciones
    lambda_motor >> Edge(label="15. Alert") >> sns
    lambda_motor >> Edge(label="16. Queue Task") >> sqs
    sqs >> Edge(label="17. Process") >> lambda_dashboard
    
    # EventBridge para orquestaci√≥n
    lambda_orquestador >> Edge(label="Events") >> eventbridge
    eventbridge >> Edge(label="Route") >> sqs
    
    # Dashboards
    dynamodb >> Edge(label="Data") >> quicksight
    
    # Seguridad (flujos transversales)
    iam >> Edge(label="Permisos", style="dashed", color="red") >> lambda_orquestador
    kms >> Edge(label="Encrypt", style="dashed", color="red") >> s3_docs
    kms >> Edge(label="Encrypt", style="dashed", color="red") >> dynamodb
    
    cloudwatch << Edge(label="Logs", style="dashed", color="blue") << lambda_orquestador
    cloudwatch << Edge(label="Metrics", style="dashed", color="blue") << lambda_comparador
    cloudwatch << Edge(label="Monitoring", style="dashed", color="blue") << lambda_motor

print("Diagrama generado: banco_andino_architecture.png")
```

### Instrucciones de Ejecuci√≥n

```bash
# Instalar dependencias
pip install diagrams

# Ejecutar script
python diagrams_banco_andino.py

# Resultado: banco_andino_architecture.png
```

---

## üîê Consideraciones de Seguridad

### Protecci√≥n de Datos Personales
- **Encriptaci√≥n en reposo**: KMS para S3 y DynamoDB
- **Encriptaci√≥n en tr√°nsito**: TLS 1.3 para todas las comunicaciones
- **Enmascaramiento**: PII en logs y m√©tricas
- **Retenci√≥n**: Pol√≠ticas de lifecycle seg√∫n normativa

### Control de Acceso
- **IAM Roles**: Principio de m√≠nimo privilegio
- **MFA**: Obligatorio para analistas y administradores
- **VPC**: Aislamiento de recursos cr√≠ticos
- **Security Groups**: Whitelist estricta

### Auditor√≠a y Cumplimiento
- **CloudTrail**: Registro de todas las acciones
- **CloudWatch Logs**: Trazabilidad completa
- **AWS Config**: Evaluaci√≥n continua de configuraciones
- **Reportes de cumplimiento**: SARLAFT, KYC, AML

---

## üìà M√©tricas y KPIs

### Operativas
- ‚è±Ô∏è **Tiempo promedio de procesamiento**: < 2 minutos
- ‚úÖ **Tasa de procesamiento autom√°tico**: > 70%
- üéØ **Precisi√≥n de detecci√≥n**: > 95%
- üîÑ **Tasa de falsos positivos**: < 5%

### Negocio
- üí∞ **Reducci√≥n de costos operativos**: 60%
- üìä **Mejora en satisfacci√≥n del cliente**: +40%
- ‚öñÔ∏è **Reducci√≥n de riesgos de cumplimiento**: 80%
- üöÄ **Capacidad de procesamiento**: 10,000 solicitudes/d√≠a

---

## üöÄ Plan de Implementaci√≥n

### Fase 1: Foundation (Semanas 1-4)
- ‚úÖ Configuraci√≥n de infraestructura AWS
- ‚úÖ Implementaci√≥n de autenticaci√≥n y API Gateway
- ‚úÖ Setup de almacenamiento (S3, DynamoDB)

### Fase 2: Core Processing (Semanas 5-8)
- ‚úÖ Integraci√≥n de Textract y Rekognition
- ‚úÖ Desarrollo del motor de comparaci√≥n
- ‚úÖ Implementaci√≥n de reglas de negocio b√°sicas

### Fase 3: Intelligence Layer (Semanas 9-12)
- ‚úÖ Entrenamiento de modelos ML en SageMaker
- ‚úÖ Integraci√≥n de Comprehend
- ‚úÖ Optimizaci√≥n del motor de reglas

### Fase 4: User Interface (Semanas 13-16)
- ‚úÖ Dashboard de analistas
- ‚úÖ Sistema de notificaciones
- ‚úÖ Reportes y visualizaciones

### Fase 5: Testing & Launch (Semanas 17-20)
- ‚úÖ Pruebas de carga y seguridad
- ‚úÖ Pilot con usuarios seleccionados
- ‚úÖ Lanzamiento gradual y monitoreo

---

## üí° Casos de Uso Espec√≠ficos

### Caso 1: Inconsistencia en Nombres
**Formulario**: Juan Carlos Rodr√≠guez  
**C√©dula**: Juan C. Rodriguez  
**Resultado**: ‚úÖ Aprobado (fuzzy matching 95%)

### Caso 2: Discrepancia en Ingresos
**Formulario**: Ingresos $5,000,000  
**Certificado laboral**: Ingresos $3,500,000  
**Resultado**: ‚ö†Ô∏è Revisi√≥n humana (diferencia >20%)

### Caso 3: Documento Ilegible
**C√©dula**: Imagen borrosa, OCR confianza <70%  
**Resultado**: üî¥ Solicitud de nuevo documento

---

## üîß Tecnolog√≠as y Herramientas

| Componente | Tecnolog√≠a | Prop√≥sito |
|-----------|-----------|-----------|
| Frontend | React + Amplify | App de onboarding |
| Autenticaci√≥n | AWS Cognito | Gesti√≥n de usuarios |
| API | API Gateway + Lambda | Servicios RESTful |
| Almacenamiento | S3 + DynamoDB | Documentos y datos |
| OCR | Amazon Textract | Extracci√≥n de texto |
| An√°lisis Visual | Amazon Rekognition | Validaci√≥n de rostros |
| NLP | Amazon Comprehend | An√°lisis de texto |
| ML | Amazon SageMaker | Modelos personalizados |
| Orquestaci√≥n | AWS Lambda + EventBridge | Flujos de trabajo |
| Notificaciones | SNS + SQS | Alertas y colas |
| Monitoreo | CloudWatch + CloudTrail | Logs y auditor√≠a |
| Seguridad | IAM + KMS | Acceso y encriptaci√≥n |
| Analytics | QuickSight | Dashboards ejecutivos |

---

## üìû Contacto y Soporte

**Equipo de Arquitectura**  
üìß arquitectura@bancoandino.com

**Equipo de Seguridad**  
üìß seguridad@bancoandino.com

**Soporte T√©cnico**  
üìß soporte@bancoandino.com  
‚òéÔ∏è +57 1 234 5678

---

## üìù Notas Finales

Este documento representa la arquitectura propuesta para el sistema de detecci√≥n inteligente de inconsistencias. La implementaci√≥n debe seguir las mejores pr√°cticas de AWS Well-Architected Framework y estar alineada con las normativas locales de protecci√≥n de datos.

**√öltima actualizaci√≥n**: Octubre 2025  
**Versi√≥n**: 1.0  
**Estado**: Propuesta inicial

