@startuml
!theme plain
skinparam backgroundColor #FEFEFE
skinparam componentStyle rectangle

package "Capa de Cliente" {
  [Cognito (Auth MFA)] as Cognito
  [App Web/MÃ³vil] as App
}

package "Capa de Entrada" {
  [API Gateway] as APIGW
  [Lambda Validador Entrada] as LambdaAuth
}

package "Almacenamiento" {
  [S3 Documentos] as S3Docs
  [S3 Reportes] as S3Reports
  [DynamoDB Formularios/Estados] as DDB
}

package "Procesamiento Inteligente" {
  [Lambda Orquestador] as Orq
  [Textract OCR] as Textract
  [Rekognition] as Rekognition
  [Comprehend NLP] as Comprehend
  [SageMaker ML] as SageMaker
  [Lambda Comparador] as CompLambda
  [Lambda Motor Reglas/IA] as RulesLambda
}

package "Reportes y Notificaciones" {
  [Lambda Reportes] as ReportsLambda
  [SNS Alertas] as SNS
  [SQS Cola] as SQS
  [EventBridge] as EventBridge
  [QuickSight Dashboards] as QuickSight
}

package "Seguridad y AuditorÃ­a" {
  [IAM] as IAM
  [KMS] as KMS
  [CloudWatch] as CloudWatch
}

package "Backoffice" {
  [Dashboard Analistas] as Dashboard
}

App --> Cognito : 1. Auth
Cognito --> APIGW : 2. Token
APIGW --> LambdaAuth : 3. Validate

LambdaAuth --> S3Docs : 4. Store Docs
LambdaAuth --> DDB : 5. Store Form
LambdaAuth --> Orq : 6. Trigger

Orq --> Textract : 7. Extract Text
Textract --> CompLambda : 7.1 Text Data
Orq --> Rekognition : 8. Analyze Image
Rekognition --> CompLambda : 8.1 Face/Doc
S3Docs --> Textract : Read Docs
S3Docs --> Rekognition : Read Images
DDB --> CompLambda : Read Form

CompLambda --> RulesLambda : 9. Inconsistencies
RulesLambda --> Comprehend : 10. NLP
RulesLambda --> SageMaker : 11. ML Scoring
RulesLambda --> ReportsLambda : 12. Results
ReportsLambda --> S3Reports : 13. Save PDF
ReportsLambda --> DDB : 14. Update Status

RulesLambda --> SNS : 15. Alert
RulesLambda --> SQS : 16. Queue Task
SQS --> Dashboard : 17. Process

Orq --> EventBridge : Events
EventBridge --> SQS : Route

DDB --> QuickSight : Data

IAM ..> Orq : Permisos
KMS ..> S3Docs : Encrypt
KMS ..> DDB : Encrypt
CloudWatch .. Orq : Logs/Metrics
CloudWatch .. CompLambda : Metrics
CloudWatch .. RulesLambda : Metrics

@enduml
